<div class="@($"col {(IsInput ? "input" : "output")} {(SharingRow ? "sharing" : "")}")">
	<div class="name">
		<span class="@(IsInput ? "pl-3 pr-1" : "pr-3 pl-1")">@Port.Connection.Name</span>
	</div>

	<MudTooltip TooltipContent="GetDebugValueFragment(Port)" Placement="Placement.Top">
		<PortRenderer @key="Port" Port="Port" Class="rounded-full absolute" Style="@($"background-color: {Port.PortColor}")" />
	</MudTooltip>

	@if (IsInput && Port.Connection.Type.AllowTextboxEdit && Port.Links.Count == 0)
	{
		<MudTextField T="string" Class="border rounded pr-2" Value="@Port.Connection.TextboxValue" ValueChanged="x => GraphCanvas.OnTextboxValueChanged(Port, x)" Label="@Port.Connection.Name" Variant="Variant.Outlined" Margin="Margin.Dense" />
	}
</div>

@code {

	[Parameter]
	public GraphCanvas GraphCanvas { get; set; } = null!;

	[Parameter]
	public GraphNodeModel Node { get; set; } = null!;

	[Parameter]
	public GraphPortModel Port { get; set; } = null!;

	[Parameter]
	public bool IsInput { get; set; }

	[Parameter]
	public bool SharingRow { get; set; }


	private RenderFragment GetDebugValueFragment(GraphPortModel port) =>@<span>@GetDebugValue(port)</span>;

	private string GetDebugValue(GraphPortModel port)
	{
		// Check if we're paused at a breakpoint in hard debugging mode
		if (GraphCanvas.Graph.Project.IsPausedAtBreakpoint && port.Connection.GraphIndex >= 0)
		{
			var (value, success) = GraphCanvas.Graph.Project.GetVariableValueAtBreakpoint(port.Connection.GraphIndex);
			if (success)
				return value;
			// If not successful (e.g., variable not in current scope), fall through to show type
		}

		// Check for live debugging (soft debugging with GraphExecutor)
		if (GraphCanvas.Graph.Project.IsLiveDebuggingEnabled && port.Connection.GraphIndex >= 0)
		{
			return GraphCanvas.DebuggedPathService.GetDebugValue(port.Connection);
		}

		// Default: just show the type name
		return port.Connection.Type.FriendlyName;
	}
}
