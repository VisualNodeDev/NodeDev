<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout Style="height: 100%; width: 100%">
	<MudAppBar Elevation="1">
		<MudButton OnClick="Save" Class="ml-3">Save</MudButton>
		<MudButton OnClick="Add" Class="ml-3">Add node</MudButton>
		<MudButton OnClick="Run" Class="ml-3">Run</MudButton>
		<MudSpacer />
		<MudIconButton Icon="@Icons.Material.Filled.MoreVert" Color="Color.Inherit" Edge="Edge.End" />
	</MudAppBar>
	<MudMainContent Style="width: 100%; height: 100%">

		<MudStack Row="true" Class="h100 pa-1">

			<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-2 h100" KeepPanelsAlive="true" Style="width: 25; height: 100%">
				<MudTabPanel Text="Project">
					<ProjectExplorer Project="Project" @bind-SelectedClass="SelectedClass"></ProjectExplorer>
				</MudTabPanel>
				<MudTabPanel Text="Class">
					@if(SelectedClass != null)
					{
						<ClassExplorer @key="SelectedClass" Class="SelectedClass" @bind-SelectedMethod="SelectedClassMethod" ></ClassExplorer>
					}
				</MudTabPanel>
			</MudTabs>

			@if(SelectedClassMethod != null)
			{
				<GraphCanvas @key="SelectedClassMethod.Graph" Graph="SelectedClassMethod.Graph"></GraphCanvas>
			}

		</MudStack>
	</MudMainContent>
</MudLayout>

@code {

	private Core.Project Project { get; set; } = null!;

	private Core.Class.NodeClass? SelectedClass { get; set; }

	private Core.Class.NodeClassMethod? SelectedClassMethod { get; set; }

	protected override void OnInitialized()
	{
		if (File.Exists("project.json"))
			Project = Core.Project.Deserialize(File.ReadAllText("graph.json"));
		else
			Project = Core.Project.CreateNewDefaultProject();
	}

	private void Save()
	{
	}

	private void Add()
	{
		//GraphCanvas?.ShowAddNode();
	}

	public void Run()
	{

	}
}