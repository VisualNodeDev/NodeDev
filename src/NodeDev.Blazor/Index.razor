<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
	<MudAppBar Elevation="1">
		<MudButton OnClick="Save" Class="ml-3">Save</MudButton>
		<MudButton OnClick="Add" Class="ml-3">Add node</MudButton>
		<MudButton OnClick="Run" Class="ml-3">Run</MudButton>
		<MudSpacer />
		<MudIconButton Icon="@Icons.Material.Filled.MoreVert" Color="Color.Inherit" Edge="Edge.End" />
	</MudAppBar>
	<MudMainContent>
		<GraphCanvas @ref="GraphCanvas" Graph="Graph"></GraphCanvas>
	</MudMainContent>
</MudLayout>

@code {

	private Core.Graph Graph { get; set; } = null!;

	private GraphCanvas? GraphCanvas { get; set; }

	protected override void OnInitialized()
	{
		if (File.Exists("graph.json"))
			Graph = Core.Graph.Deserialize(File.ReadAllText("graph.json"));
		else
			Graph = new Core.Graph();
	}

	private void Save()
	{
		File.WriteAllText("graph.json", Graph.Serialize());
	}

	private void Add()
	{
		GraphCanvas?.ShowAddNode();
	}

	public void Run()
	{
		var executor = new Core.GraphExecutor(Graph);

		executor.Execute(new object[0], new object[0]);
	}
}